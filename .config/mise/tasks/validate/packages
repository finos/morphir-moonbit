#!/usr/bin/env bash
# mise description="Verify package structure is valid"
set -euo pipefail

echo "üîç Verifying package structure..."

PACKAGES=("morphir-sdk" "morphir-core" "morphir-moonbit-bindings")
ERRORS=0

for pkg in "${PACKAGES[@]}"; do
  if [ ! -f "pkgs/$pkg/moon.mod.json" ]; then
    echo "‚ùå ERROR: moon.mod.json missing for $pkg"
    ERRORS=$((ERRORS + 1))
  fi
  
  if [ ! -f "pkgs/$pkg/moon.pkg.json" ]; then
    echo "‚ùå ERROR: moon.pkg.json missing for $pkg"
    ERRORS=$((ERRORS + 1))
  fi
  
  if [ -f "pkgs/$pkg/moon.mod.json" ] && [ -f "pkgs/$pkg/moon.pkg.json" ]; then
    echo "‚úì $pkg package configuration found"
  fi
done

if [ $ERRORS -eq 0 ]; then
  echo "‚úÖ All package configurations valid"
  exit 0
else
  echo "‚ùå Found $ERRORS configuration error(s)"
  exit 1
fi
